wp_optimize_send_command_admin_ajax=function(t,i,e,o){o="undefined"==typeof o||o;var n={action:"wp_optimize_ajax",subaction:t,nonce:wp_optimize_ajax_nonce,data:i};jQuery.post(ajaxurl,n,function(t){if(o){try{var i=JSON.parse(t)}catch(n){return console.log(n),console.log(t),void alert(wpoptimize.error_unexpected_response)}"undefined"!=typeof e&&e(i)}else"undefined"!=typeof e&&e(t)})},jQuery(document).ready(function(t){WP_Optimize=WP_Optimize(wp_optimize_send_command_admin_ajax)});var WP_Optimize=function(t){function i(){if(v("#enable-schedule").length){var t=v("#enable-schedule").is(":checked");t?v("#wp-optimize-auto-options").css("opacity","1"):v("#wp-optimize-auto-options").css("opacity","0.5")}}function e(t,i,e){i="undefined"==typeof i?"#wp-optimize-wrap":i,e="undefined"==typeof e?15:e,v(t).hide().prependTo(i).slideDown("slow").delay(1e3*e).slideUp("slow",function(){v(this).remove()})}function o(i,o){var n={type:i,enable:o?1:0};v("#"+i+"_spinner").show(),t("enable_or_disable_feature",n,function(t){if(v("#"+i+"_spinner").hide(),t&&t.hasOwnProperty("output"))for(var o=0,n=t.output.length;o<n;o++){var a='<div class="updated">'+t.output[o]+"</div>";e(a,"#actions-results-area")}})}function n(t){var i="",t="undefined"==typeof t?"string":t;return"object"==t?i=v("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select, #wp-optimize-nav-tab-contents-optimize input[type='checkbox'], .wp-optimize-nav-tab-contents input[name^='enable-auto-backup-']").serializeJSON({useIntKeysAsArrayIndex:!0}):(i=v("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select, #wp-optimize-nav-tab-contents-optimize input[type='checkbox'], .wp-optimize-nav-tab-contents input[name^='enable-auto-backup-']").serialize(),v.each(v('#wp-optimize-nav-tab-contents-settings form input[type=checkbox], .wp-optimize-nav-tab-contents input[name^="enable-auto-backup-"]').filter(function(t){return 0==v(this).prop("checked")}),function(t,e){var o="0";i+="&"+v(e).attr("name")+"="+o})),i}function a(){t("optimizations_done",{},function(){})}function s(){if(!k.get_lock())return void(y>0&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting"));y>0&&console.log("WP-Optimize: process_queue(): got queue lock");var i=k.peek();return"object"==typeof i?(data=i,i=i.optimization_id):data={},"undefined"==typeof i?(y>0&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),k.unlock(),void a()):(y>0&&console.log("WP-Optimize: process_queue(): processing item: "+i),k.dequeue(),v(document).trigger(["do_optimization_",i,"_start"].join("")),void t("do_optimization",{optimization_id:i,data:data},function(t){if(v("#optimization_spinner_"+i).hide(),v("#optimization_checkbox_"+i).show(),v(".optimization_button_"+i).prop("disabled",!1),v(document).trigger(["do_optimization_",i,"_done"].join(""),t),t){for(var e="",o=0,n=t.errors.length;o<n;o++)e+='<span class="error">'+t.errors[o]+"</span><br>";for(var o=0,n=t.messages.length;o<n;o++)e+=t.errors[o]+"<br>";for(var o=0,n=t.result.output.length;o<n;o++)e+=t.result.output[o]+"<br>";if(v("#optimization_info_"+i).html(e),t.hasOwnProperty("status_box_contents")&&v("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t.status_box_contents),t.hasOwnProperty("table_list")&&v("#wpoptimize_table_list tbody").html(v(t.table_list).find("tbody").html()),t.hasOwnProperty("total_size")&&v("#optimize_current_db_size").html(t.total_size),"optimizetables"==i&&data.optimization_table&&(k.is_empty()?(v("#optimization_spinner_"+i).hide(),v("#optimization_checkbox_"+i).show(),v(".optimization_button_"+i).prop("disabled",!1),v("#optimization_info_"+i).html(wpoptimize.optimization_complete)):(v("#optimization_checkbox_"+i).hide(),v("#optimization_spinner_"+i).show(),v(".optimization_button_"+i).prop("disabled",!0))),t.result.meta&&t.result.meta.hasOwnProperty("awaiting_mod")){var a=t.result.meta.awaiting_mod;a>0?v("#adminmenu .awaiting-mod .pending-count").remove(a):v("#adminmenu .awaiting-mod").remove()}}setTimeout(function(){k.unlock(),s()},10)}))}function p(t){var i=v("#wp-optimize-nav-tab-contents-optimize .wp-optimize-settings-"+t);if(i||console.log("do_optimization: row corresponding to this optimization ("+t+") not found"),1!=v(".optimization_button_"+t).prop("disabled")){if(v("#optimization_checkbox_"+t).hide(),v("#optimization_spinner_"+t).show(),v(".optimization_button_"+t).prop("disabled",!0),v("#optimization_info_"+t).html("..."),"optimizetables"==t){var e=v("#wpoptimize_table_list #the-list tr");v(e).each(function(i){var e=v(this).find("td");if(table_type=e.eq(5).text(),table=e.eq(1).text(),optimizable=e.eq(5).data("optimizable"),""!=table&&("1"==optimizable||S)){var o={optimization_id:t,optimization_table:e.eq(1).text(),optimization_table_type:table_type,optimization_force:S};k.enqueue(o)}})}else k.enqueue(t);s()}}function r(i){v("#wpo_settings_sites_list").length?t("save_site_settings",{"wpo-sites":c()},function(){i&&i()}):i&&i()}function c(){var t=[];return v('#wpo_settings_sites_list input[type="checkbox"]').each(function(){var i=v(this);i.is(":checked")&&t.push(i.attr("value"))}),t}function _(){var t=!1;v("#enable-auto-backup").is(":checked")&&(t=!0),u(),1==t?l(b):b()}function l(t){"function"==typeof updraft_backupnow_inpage_go?updraft_backupnow_inpage_go(function(){v("#updraft-backupnow-inpage-modal").dialog("close"),t&&t()},"","autobackup",0,1,0,wpoptimize.automatic_backup_before_optimizations):t&&t()}function u(){var i=n("object");i.auto_backup=v("#enable-auto-backup").is(":checked"),t("save_auto_backup_option",i)}function m(t,i,e,o){t.on("click",function(){return i.hasClass("wpo_always_visible")||i.toggleClass("wpo_hidden"),!1}),e.on("change",function(){e.is(":checked")?o.prop("checked",!0):o.prop("checked",!1),d(e,o)}),o.on("change",function(){d(e,o)}),d(e,o)}function d(t,i){var e=0,o=0;if(i.each(function(){v(this).is(":checked")&&o++,e++}),t.next().is("label")&&t.next().data("label")){var n=t.next(),a=n.data("label");e==o?n.text(a):n.text(a.replace("all",[o," of ",e].join("")))}e==o?t.prop("checked",!0):t.prop("checked",!1)}function b(){$optimizations=v("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(t,i){return t=v(t).closest(".wp-optimize-settings").data("optimization_run_sort_order"),i=v(i).closest(".wp-optimize-settings").data("optimization_run_sort_order"),t>i?1:t<i?-1:0});var i={};$optimizations.each(function(t){var e=v(this).closest(".wp-optimize-settings").data("optimization_id");return e?(i[e]={active:1},void p(e)):void console.log("Optimization ID corresponding to pressed button not found")}),t("save_manual_run_optimization_options",i)}function f(t){v(".run-single-table-optimization").each(function(){var i=v(this);i.data("disabled")&&(t?i.prop("disabled",!1):i.prop("disabled",!0))})}function z(t){var i,e,o;if(t)for(i in t)t.hasOwnProperty(i)&&(e=["#wp-optimize-settings-",t[i].dom_id].join(""),o=t[i].info?t[i].info.join("<br>"):"",v(e+" .wp-optimize-settings-optimization-info").html(o))}function w(){var i=["",c().join("_")].join("");B.hasOwnProperty(i)?z(B[i]):t("get_optimizations_info",{"wpo-sites":c()},function(t){t&&(B[i]=t,z(t))})}function h(i){var e=v("#wpo_import_spinner"),o=v("#wpo_import_success_message"),n=v("#wpo_import_error_message");e.show(),t("import_settings",{settings:i},function(t){e.hide(),t&&t.errors&&t.errors.length?(n.text(t.errors.join("<br>")),n.slideDown()):t&&t.messages&&t.messages.length&&(o.text(t.messages.join("<br>")),o.slideDown(),setTimeout(function(){window.location.reload()},500)),v("#wpo_import_settings_btn").prop("disabled",!1)})}function g(t,i){var e=document.body.appendChild(document.createElement("a")),o=new Date,n=o.getFullYear(),a=o.getMonth()<10?["0",o.getMonth()].join(""):o.getMonth(),s=o.getDay()<10?["0",o.getDay()].join(""):o.getDay();i=i?i:["wpo-settings-",n,"-",a,"-",s,".json"].join(""),e.setAttribute("download",i),e.setAttribute("style","display:none;"),e.setAttribute("href","data:text/json;charset=UTF-8,"+encodeURIComponent(JSON.stringify(t))),e.click()}var v=jQuery,y=0,k=new Updraft_Queue;i(),v("#enable-schedule").change(function(){i()});var x=v("#wpoptimize_table_list_filter"),j=v("#wpoptimize_table_list"),O=v("#wpoptimize_table_list tbody:last"),P=v("#wpoptimize_table_list_tables_not_found");v(function(){j.tablesorter({theme:"default",widgets:["zebra","rows","filter"],cssInfoBlock:"tablesorter-no-sort",headers:{7:{sorter:!1}},widgetOptions:{filter_external:x,filter_defaultFilter:{2:"~{query}"}}}),j.on("filterEnd",function(){var t=v.trim(x.val());""==t?O.show():O.hide(),0==v("#the-list tr:visible",j).length?P.show():P.hide()})}),v("#wp-optimize-disable-enable-trackbacks-enable").click(function(){o("trackbacks",!0)}),v("#wp-optimize-disable-enable-trackbacks-disable").click(function(){o("trackbacks",!1)}),v("#wp-optimize-disable-enable-comments-enable").click(function(){o("comments",!0)}),v("#wp-optimize-disable-enable-comments-disable").click(function(){o("comments",!1)}),v("#wp-optimize-nav-tab-wrapper .nav-tab").click(function(t){var i=v(this).attr("id");if(i&&"wp-optimize-nav-tab-"==i.substring(0,20)){var i=i.substring(20);t.preventDefault(),v("#wp-optimize-nav-tab-wrapper .nav-tab:not(#wp-optimize-nav-tab-"+i+")").removeClass("nav-tab-active"),v(this).addClass("nav-tab-active"),v("#wp-optimize-wrap .wp-optimize-nav-tab-contents:not(#wp-optimize-nav-tab-contents-"+i+")").hide(),v("#wp-optimize-nav-tab-contents-"+i).show(),"tables"==i&&v("#wpoptimize_table_list").trigger("applyWidgets")}}),v("#wp-optimize-nav-tab-contents-optimize").on("click","button.wp-optimize-settings-optimization-run-button",function(){var t=v(this).closest(".wp-optimize-settings").data("optimization_id");return t?void(1!=v(".optimization_button_"+t).prop("disabled")&&(v(".optimization_button_"+t).prop("disabled",!0),r(function(){v(".optimization_button_"+t).prop("disabled",!1),p(t)}))):void console.log("Optimization ID corresponding to pressed button not found")}),v("#wp-optimize-nav-tab-contents-optimize").on("click","#wp-optimize",function(t){var i=v(this);t.preventDefault(),i.prop("disabled",!0),r(function(){i.prop("disabled",!1),_()})});var q=v("#wpo_settings_sites_list"),D=q.find("ul").first(),C=v('input[type="checkbox"]',D),T=q.find("#wpo_all_sites"),W=v("#wpo_sitelist_show_moreoptions"),A=v("#wpo_sitelist_moreoptions"),I=v("#wpo_settings_sites_list_cron"),Q=I.find("ul").first(),U=v('input[type="checkbox"]',Q),F=I.find("#wpo_all_sites_cron"),$=v("#wpo_sitelist_show_moreoptions_cron"),J=v("#wpo_sitelist_moreoptions_cron");m(W,A,T,C);var M=0;v([T,C]).each(function(){v(this).on("change",function(){M++,setTimeout(function(){M--,0==M&&w()},1e3)})}),m($,J,F,U),v("#wp_optimize_table_list_refresh").click(function(){v("#wpoptimize_table_list tbody").css("opacity","0.5"),t("get_table_list",!1,function(t){if(t.hasOwnProperty("table_list")){var i=!0,e=function(t){v("#wpoptimize_table_list tbody").css("opacity","1")};v("#wpoptimize_table_list").trigger("updateAll",[i,e])}t.hasOwnProperty("total_size")&&v("#optimize_current_db_size").html(t.total_size),f(R.is(":checked"))})}),v("#settings_form").on("click","#wp-optimize-settings-save",function(i){i.preventDefault(),v("#save_spinner").show();var o=n();t("save_settings",o,function(t){if(v("#save_spinner").hide(),v("#save_done").show().delay(5e3).fadeOut(),t&&t.hasOwnProperty("save_results")&&t.save_results&&t.save_results.hasOwnProperty("errors")){for(var i=0,o=t.save_results.errors.length;i<o;i++){var n='<div class="error">'+t.errors[i]+"</div>";e(n,"#wp-optimize-settings-save-results")}console.log(t.save_results.messages)}t&&t.hasOwnProperty("status_box_contents")&&v("#wp_optimize_status_box .inside").html(t.status_box_contents),t&&t.hasOwnProperty("optimizations_table")&&v("#optimizations_list").replaceWith(t.optimizations_table),t.save_results.refresh&&location.reload()})}),v("#wp_optimize_status_box").on("click","#wp_optimize_status_box_refresh",function(i){i.preventDefault(),v("#wp_optimize_status_box").css("opacity","0.5"),t("get_status_box_contents",null,function(t){v("#wp_optimize_status_box").css("opacity","1").find(".inside").html(t)})});var N=v("#innodb_force_optimize"),S=N.is(":checked"),E=N.closest("tr"),R=v("#innodb_force_optimize_single");N.on("change",function(){v('button, input[type="checkbox"]',E).each(function(){S=N.is(":checked");var t=v(this);t.data("disabled")&&(S?t.prop("disabled",!1):t.prop("disabled",!0))})}),v("#wpoptimize_table_list").on("click",".run-single-table-optimization",function(){var i=v(this),e=i.next(),o=e.next(),n=i.data("table"),a=i.data("type"),s={optimization_id:"optimizetables",optimization_table:n,optimization_table_type:a};e.removeClass("visibility-hidden"),t("do_optimization",{optimization_id:"optimizetables",data:s},function(){i.prop("disabled",!1),e.addClass("visibility-hidden"),o.show().removeClass("visibility-hidden").delay(3e3).fadeOut("slow")})}),R.change(function(){f(R.is(":checked"))}),f(R.is(":checked"));var B={};setTimeout(function(){t("check_overdue_crons",null,function(t){t&&t.hasOwnProperty("m")&&v("#wpo_settings_warnings").append(t.m)})},11e3),v("#wpo_import_settings_btn").on("click",function(t){var i=v("#wpo_import_settings_file"),e=i.val(),o=i[0].files[0],n=new FileReader;return v("#wpo_import_settings_btn").prop("disabled",!0),/\.json$/.test(e)?(n.onload=function(){h(this.result)},n.readAsText(o),!1):(t.preventDefault(),v("#wpo_import_settings_btn").prop("disabled",!1),v("#wpo_import_error_message").text(wpoptimize.please_select_settings_file).slideDown(),!1)}),v("#wpo_import_settings_file").on("change",function(){v("#wpo_import_error_message").slideUp()}),v("#wpo_export_settings_btn").on("click",function(t){return g(n("object")),!1});var K=function(i,e,o){t("get_optimization_info",{optimization_id:e,data:o},function(t){var o=t&&t.result&&t.result.meta?t.result.meta:{},n=t&&t.result&&t.result.output?t.result.output.join("<br>"):"...";v(document).trigger(["optimization_get_info_",e].join(""),n),i.html(n),o.finished?v(document).trigger(["optimization_get_info_",e,"_done"].join(""),t):setTimeout(function(){K(i,e,o)},1)})};return v(document).ready(function(){v(".wp-optimize-optimization-info-ajax").each(function(){var t=v(this),i=t.parent(),e=t.data("id");v(document).trigger(["optimization_get_info_",e,"_start"].join("")),K(i,e,{support_ajax_get_info:!0})})}),setTimeout(function(){t("check_overdue_crons",null,function(t){t&&t.hasOwnProperty("m")&&v("#wpo_settings_warnings").append(t.m)})},11e3),{send_command:t,optimization_get_info:K,take_a_backup_with_updraftplus:l,save_auto_backup_options:u}};jQuery(document).ready(function(t){function i(i){var e=["#",i.data("additional")].join("");i.is(":checked")?t(e).show():t(e).hide()}t(".wp-optimize-logging-settings").each(function(){var e=t(this);i(e),e.on("change",function(){i(e)})})});