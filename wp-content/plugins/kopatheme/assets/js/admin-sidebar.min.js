jQuery(document).ready(function(e){function a(){var a=e(this),i=a.siblings(".kopa_sidebar_add_button");return a.val()?void i.removeClass("kopa_button_inactive"):void i.addClass("kopa_button_inactive")}function i(a){a.preventDefault();var i=e(this),t=i.find(".kopa_sidebar_title_action");t.hasClass("kopa_action_close")?t.removeClass("kopa_action_close"):t.addClass("kopa_action_close"),i.siblings(".kopa_sidebar_body").slideToggle("fast")}function t(a){a.preventDefault();var i=e(this),t=i.parents(".kopa_sidebar_body"),o=t.siblings(".kopa_sidebar_header"),s=o.find(".kopa_sidebar_title_action");t.slideUp("fast"),s.removeClass("kopa_action_close")}function o(a){a.preventDefault();var o=e(this),n=o.siblings(".kopa_sidebar_add_field"),d=n.val(),_=o.data("registered-sidebars")+1,l=o.data("register-sidebar-ids"),c="sidebar-"+_,b=o.data("name"),p=o.data("container-id"),k=e("#"+p),f="";if(!o.hasClass("kopa_button_inactive")&&""!==d){for(;l.search(c)>=0;)_++,c="sidebar-"+_;f='<li class="kopa_sidebar">',f+='<div class="kopa_sidebar_header">',f+='<div class="kopa_sidebar_title_action"></div>',f+="<strong>"+d+"</strong>",f+="</div>",f+='<div class="kopa_sidebar_body">';var u=kopa_sidebar_attributes_l10n.attributes;f+='<label><input class="kopa_sidebar_advanced_settings" type="checkbox"> '+kopa_sidebar_attributes_l10n.advanced_settings+"</label>";for(var v in u)f+='<div class="kopa_sidebar_'+v+'">',f+='<input type="text" class="kopa_sidebar kopa_sidebar_attr" name="'+b+"["+c+"]["+v+']" id="kopa_sidebar_'+_+"_"+v+'" '+("name"===v?'value="'+d+'"':"")+' placeholder="'+u[v]+'">',f+="</div>";f+='<div class="kopa_sidebar_control_actions">',f+='<a class="kopa_sidebar_delete_button" href="#">'+kopa_sidebar_attributes_l10n.remove+"</a>",f+=" | ",f+='<a class="kopa_sidebar_close_button" href="#">'+kopa_sidebar_attributes_l10n.close+"</a>",f+='<span class="spinner"></span>',f+="</div>",f+="</div>",f+="</li>",k.append(f);var m=k.children("li:last");viewportTop=e(window).scrollTop(),viewportBottom=e(window).scrollTop()+e(window).height(),sidebarBounds=m.offset(),$newElementHeader=m.children(".kopa_sidebar_header"),$newElementBody=m.children(".kopa_sidebar_body"),$newElementTitleAction=m.find(".kopa_sidebar_title_action"),$newElementCloseButton=m.find(".kopa_sidebar_close_button"),$newElementDeleteButton=m.find(".kopa_sidebar_delete_button"),$newElementAdvancedButton=m.find(".kopa_sidebar_advanced_settings"),$newElementTitleAction.addClass("kopa_action_close"),viewportBottom<sidebarBounds.top?e("html, body").animate({scrollTop:m.offset().top-130},{duration:200,complete:function(){$newElementBody.slideDown("fast")}}):$newElementBody.slideDown("fast"),o.data("registered-sidebars",_),n.val(""),o.addClass("kopa_button_inactive"),$newElementHeader.on("click",i),$newElementCloseButton.on("click",t),$newElementDeleteButton.on("click",s),$newElementAdvancedButton.on("click",r)}}function s(a){a.preventDefault();var i=e(this),t=i.data("sidebar-id"),o="<strong>"+kopa_sidebar_attributes_l10n.confirm_message+"</strong>";t?e.ajax({url:kopa_sidebar_attributes_l10n.ajax_url,type:"POST",data:{action:"kopa_remove_sidebar",sidebar_id:t},beforeSend:function(){i.siblings(".spinner").show()},success:function(a){i.siblings(".spinner").hide(),a=e.parseJSON(a);var t=a.allow_delete,s=a.warnings,d=a.errors,r="";t?(s.push(o),r=s.join("<br>"),n("confirm",i,kopa_sidebar_attributes_l10n.warning,r)):(r+=d.join("<br>"),n("alert",i,kopa_sidebar_attributes_l10n.error,r))}}):n("confirm",i,kopa_sidebar_attributes_l10n.info,o)}function n(a,i,t,o){var s=e("#kopa_modal_info"),n=s.find("#kopa_modal_confirm"),r=n.find("#kopa_confirm_ok"),_=n.find("#kopa_confirm_cancel");"confirm"!=a?n.hide():n.show(),s.find(".kopa_modal_info").empty().append(o),tb_show(t,"#TB_inline?width=450&height=420&inlineId=kopa_modal_info"),r.off("click",d).on("click",{allowDelete:!0,selector:i},d),_.off("click",d).on("click",{allowDelete:!1,selector:i},d)}function d(a){a.preventDefault();var i=a.data.allowDelete,t=a.data.selector;i&&t.parents(".kopa_sidebar").slideUp("fast",function(){e(this).remove()}),tb_remove()}function r(){var a=e(this);a.parent().siblings(".kopa_sidebar_before_widget, .kopa_sidebar_after_widget, .kopa_sidebar_before_title, .kopa_sidebar_after_title").slideToggle("fast")}e(".kopa_sidebar_sortable").sortable({handle:".kopa_sidebar_header"}),e(".kopa_sidebar_add_field").on("keyup",a),e(".kopa_sidebar_add_button").on("click",o),e(".kopa_sidebar_header").on("click",i),e(".kopa_sidebar_close_button").on("click",t),e(".kopa_sidebar_delete_button").on("click",s),e(".kopa_sidebar_advanced_settings").on("click",r)});