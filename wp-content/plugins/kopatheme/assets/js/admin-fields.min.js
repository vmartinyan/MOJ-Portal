var Kopa_UI,Kopa_UI_DateTime,Kopa_UI_Gallery,Kopa_UI_Icon,Kopa_UI_Gallery_Sortable,Kopa_UI_Image,Kopa_UI_Repeater,Kopa_UI_Repeater_Link,Kopa_UI_Chosen,Kopa_UI_Icon_Picker,$kopa_icon_picker_activated,$kopa_gallery_sortable_uploader,$kopa_gallery_iframe,$kopa_gallery_button;jQuery(document).ready(function(){Kopa_UI.init()}),jQuery(document).ajaxSuccess(function(){Kopa_UI.init()});var Kopa_UI={init:function(){Kopa_UI_DateTime.init(),Kopa_UI_Image.init(),Kopa_UI_Gallery.init(),Kopa_UI_Gallery_Sortable.init(),Kopa_UI_Icon.init(),Kopa_UI_Icon_Picker.init(),Kopa_UI_Repeater.init(),Kopa_UI_Repeater_Link.init(),Kopa_UI_Chosen.init(),Kopa_UI_Radio_Image.init(),Kopa_UI_Link.init(),Kopa_UI_Group.init()}},Kopa_UI_DateTime={init:function(){jQuery(".kopa-framework-datetime").length>0&&jQuery(".kopa-framework-datetime").each(function(e,a){if(!jQuery(a).hasClass("kopa-framework-datetime--activated")){var i=parseInt(jQuery(a).attr("data-timepicker"),10),t=parseInt(jQuery(a).attr("data-datepicker"),10);i=1==i?!0:!1,t=1==t?!0:!1,jQuery(a).datetimepicker({lang:"en",timepicker:i,datepicker:t,format:jQuery(a).attr("data-format"),i18n:{en:{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"]}}}),jQuery(a).addClass("kopa-framework-datetime--activated")}})}},Kopa_UI_Gallery={init:function(){jQuery(".kopa-framework-gallery-box").on("click",".kopa-framework-gallery-config",function(e){return e.preventDefault(),$kopa_gallery_button=jQuery(this),$kopa_gallery_iframe?($kopa_gallery_iframe.open(),void 0):($kopa_gallery_iframe=wp.media.frames.$kopa_gallery_iframe=wp.media({title:"Gallery config",button:{text:"Use"},library:{type:"image"},multiple:!0}),$kopa_gallery_iframe.on("open",function(){var e,a;e=$kopa_gallery_button.parents(".kopa-framework-gallery-box").find("input.kopa-framework-gallery").val(),""!==e&&(a=$kopa_gallery_iframe.state().get("selection"),e=e.split(","),jQuery(e).each(function(e,i){var t;t=wp.media.attachment(i),t.fetch(),a.add(t?[t]:[])}))}),$kopa_gallery_iframe.on("select",function(){var e,a;e=[],a=$kopa_gallery_iframe.state().get("selection"),a.map(function(a){a=a.toJSON(),e.push(a.id)}),e.length>0&&(e=e.join(","),$kopa_gallery_button.parents(".kopa-framework-gallery-box").find("input.kopa-framework-gallery").val(e))}),$kopa_gallery_iframe.open(),void 0)})}},Kopa_UI_Icon={init:function(){jQuery(".kopa-icon-picker").length>0&&jQuery(".kopa-icon-picker").click(function(e){var a;e.preventDefault(),a=jQuery(this),1!==jQuery(Kopa_UI_Icon.get_id("#")).length?(jQuery("body").append('<div id="'+Kopa_UI_Icon.get_id("")+'" class="upside-hide"></div>'),jQuery.ajax({beforeSend:function(){},success:function(e){jQuery(Kopa_UI_Icon.get_id("#")).html(e)},complete:function(){Kopa_UI_Icon.open_lighbox(a)},url:kopa_advanced_field.ajax_url,dataType:"html",type:"GET",async:!1,data:{action:"get_lighbox_icons"}})):Kopa_UI_Icon.open_lighbox(a)})},open_lighbox:function(e){jQuery(Kopa_UI_Icon.get_id("#")).dialog({width:360,height:480,modal:!0,closeText:'<i class="dashicons dashicons-dismiss"></i>',title:kopa_advanced_field.translate.icon_picker,buttons:[{text:"Select","class":"kopa-ui-button-use button button-primary",click:function(){var a;a=Kopa_UI_Icon.click_ok(),e.parent().find(".kopa-icon-picker-value").val(a),e.parent().find(".kopa-icon-picker-preview i").attr("class",a)}}]})},click_ok:function(){var e;return e=jQuery(Kopa_UI_Icon.get_id("#")).find(".kopa-icon-item.upside-active i").attr("class"),jQuery(Kopa_UI_Icon.get_id("#")).dialog("close"),e},select_a_icon:function(e,a){e.preventDefault(),a.parents(".kopa-wrap").find(".kopa-icon-item").removeClass("upside-active"),a.addClass("upside-active")},filter_icons:function(e,a){var i,t,o;return e.preventDefault(),o=a.parents(".kopa-list-of-icon"),(i=a.val())?(t=new RegExp(i,"i"),o.find(".kopa-icon-item i").each(function(){jQuery(this).data("title").search(t)<0?jQuery(this).parent().hide():jQuery(this).parent().show()}),void 0):(o.find(".kopa-icon-item").show(),!1)},get_id:function(e){return e+"kopa_advanced_field_lighbox_icons"}},Kopa_UI_Gallery_Sortable={init:function(){$galleries=jQuery("div.kopa-ui-gallery"),$galleries.length&&$galleries.map(function(){var e=jQuery(this);e.hasClass("kopa-ui-gallery--activated")||(Kopa_UI_Gallery_Sortable._init_sortable(e.find("ul").first()),e.on("click",".kopa-ui-gallery__upload",function(e){Kopa_UI_Gallery_Sortable._edit(e,jQuery(this))}),e.on("click",".kopa-ui-gallery__remove",function(e){Kopa_UI_Gallery_Sortable._remove(e,jQuery(this))}),e.addClass("kopa-ui-gallery--activated"))})},_edit:function(e,a){return e.preventDefault(),$wrap=a.parents(".kopa-ui-gallery"),$sortable=$wrap.find("ul").first(),$inputs=$wrap.find('input[type="hidden"]'),$previews=$wrap.find("img"),$gallery_name=$wrap.attr("data-name"),$kopa_gallery_sortable_uploader?($kopa_gallery_sortable_uploader.open(),void 0):($kopa_gallery_sortable_uploader=wp.media.frames.$kopa_gallery_sortable_uploader=wp.media({title:"Uploader",$button:{text:"Select"},library:{type:"image"},multiple:!0}),$kopa_gallery_sortable_uploader.on("open",function(){$inputs.length&&(selection=$kopa_gallery_sortable_uploader.state().get("selection"),jQuery.each($inputs,function(){var e=wp.media.attachment(parseInt(jQuery(this).val()));e.fetch(),selection.add(e)}))}),$kopa_gallery_sortable_uploader.on("select",function(){var e=[],a=$kopa_gallery_sortable_uploader.state().get("selection");a.map(function(a){a=a.toJSON(),e.push([a.id,a.sizes.thumbnail.url])}),console.log(e),e.length&&($sortable.html(""),e.map(function(e){$html=Kopa_UI_Gallery_Sortable._build_single($gallery_name,e[0],e[1]),$sortable.append(jQuery($html))}))}),$kopa_gallery_sortable_uploader.open(),void 0)},_remove:function(e,a){e.preventDefault(),a.parents(".kopa-ui-gallery__image").remove()},_build_single:function(e,a,i){return $html='<li class="kopa-ui-gallery__image">',$html+='<input type="hidden" value="'+a+'" name="'+e+'[]">',$html+='<img alt="" src="'+i+'">',$html+='<span class="kopa-ui-gallery__remove dashicons dashicons-trash">',$html+="</span>",$html+="</li>"},_init_sortable:function(e){e.sortable({containment:"parent"}),e.disableSelection()}},Kopa_UI_Image={frame:{},init:function(){jQuery(".kopa-field-image").on("click",".item-add",function(e){e.preventDefault();var a=jQuery(this),i=a.next("input").attr("id");return Kopa_UI_Image.frame[i]?(Kopa_UI_Image.frame[i].open(),void 0):(Kopa_UI_Image.frame[i]=wp.media.frames.file_frame=wp.media({title:"Add Image",button:{text:"Add Image"},library:{type:"image"},multiple:!1}),Kopa_UI_Image.frame[i].on("select",function(){var e=Kopa_UI_Image.frame[i].state().get("selection").first().toJSON(),t=e.sizes.thumbnail;e.sizes.hasOwnProperty("full")&&(t=e.sizes.full),a.html('<div class="img" style="background-image:url('+t.url+')"></div>'),a.next("input").val(e.id),a.parent().addClass("hasimage")}),Kopa_UI_Image.frame[i].open(),void 0)}),jQuery(document).on("click",".kopa-field-image .item-remove",function(e){jQuery(this).parent().find(".item-add").empty(),jQuery(this).prev("input").val(""),jQuery(this).parent().removeClass("hasimage"),e.preventDefault()})}},Kopa_UI_Repeater={init:function(){var e;e=jQuery(".kopa-ui-repeater"),e.length&&jQuery.each(e,function(){var e;e=jQuery(this),e.hasClass("kopa-ui-repeater--activated")||(e.on("click",".kopa-repeater-edit",function(){var e;e=jQuery(this).parents(".kopa-repeater-group"),e.find(".kopa-repeater-item-content").is(":hidden")?e.addClass("kopa-repeater-group--open"):e.removeClass("kopa-repeater-group--open")}),e.on("keyup",".kopa-repeater-input-key",function(){var e,a,i;a=jQuery(this).val(),a=""===jQuery.trim(a)?kopa_advanced_field.translate.untitle:jQuery("<div>"+a+"</div>").text(),i=jQuery(this).parents(".kopa-repeater-group"),e=i.find("> label > span"),e.text(a)}),e.find(".kopa-ui-repeater-container").sortable(),e.find(".kopa-ui-repeater-container").repeatable({addTrigger:e.find(".kopa-repeater-add"),deleteTrigger:".kopa-repeater-delete",template:e.attr("data-id"),itemContainer:".kopa-repeater-group"}),e.addClass("kopa-ui-repeater--activated"))})}},Kopa_UI_Repeater_Link={init:function(){var e;e=jQuery(".kopa-ui-repeater-links"),e.length&&jQuery.each(e,function(){var e;e=jQuery(this),e.hasClass("kopa-ui-repeater-links--activated")||(e.on("click",".kopa-repeater-edit",function(){var e;e=jQuery(this).parents(".kopa-repeater-group"),e.find(".kopa-repeater-item-content").is(":hidden")?e.addClass("kopa-repeater-group--open"):e.removeClass("kopa-repeater-group--open")}),e.on("keyup",".kopa-repeater-input-title",function(){var e,a,i;a=jQuery(this).val(),a=""===jQuery.trim(a)?kopa_advanced_field.translate.untitle:jQuery("<div>"+a+"</div>").text(),i=jQuery(this).parents(".kopa-repeater-group"),e=i.find("> label > span"),e.text(a)}),e.find(".kopa-ui-repeater-container").sortable(),e.find(".kopa-ui-repeater-container").repeatable({addTrigger:e.find(".kopa-repeater-add"),deleteTrigger:".kopa-repeater-delete",template:e.attr("data-id"),itemContainer:".kopa-repeater-group",afterAdd:function(){Kopa_UI_Icon_Picker.init()}}),e.addClass("kopa-ui-repeater-links--activated"))})}},Kopa_UI_Chosen={init:function(){var e;e=jQuery(".kopa-ui-chosen select"),e.length&&jQuery.each(e,function(){$cbo=jQuery(this),$cbo.hasClass("kopa-ui-chosen--activated")||($cbo.chosen({allow_single_deselect:!0,width:$cbo.attr("data-width")}),$cbo.addClass("kopa-ui-chosen--activated"))})}},Kopa_UI_Icon_Picker={init:function(){var e;e=jQuery(".kopa-ui-icon-picker"),e.length&&jQuery.each(e,function(){$_icon_pickers=jQuery(this),$_icon_pickers.hasClass("kopa-ui-icon-picker--activated")||($_icon_pickers.on("click",".kopa-ui-icon-picker-add",function(){var e;e=jQuery(this),$kopa_icon_picker_activated=e.parents(".kopa-ui-icon-picker"),Kopa_UI_Icon_Picker._getBoxObject().length||(Kopa_UI_Icon_Picker._build_picker(),Kopa_UI_Icon_Picker._init_dialog()),Kopa_UI_Icon_Picker._add(e)}),$_icon_pickers.addClass("kopa-ui-icon-picker--activated"))})},_getBoxObject:function(){return jQuery("#"+Kopa_UI_Icon_Picker._getBoxId())},_getBoxId:function(){return"tmpl-kopa-icon-picker"},_add:function(){var e;e=Kopa_UI_Icon_Picker._getBoxObject(),e.hasClass("ui-dialog-content")&&e.dialog("open")},_build_picker:function(){var e,a,i,t,o;i=Kopa_UI_Icon_Picker._getBoxId(),e=$kopa_icon_picker_activated.length&&void 0!==$kopa_icon_picker_activated?$kopa_icon_picker_activated.find("input").val():!1,a='<div id="'+i+'"><div class="kopa-ui__header"><input type="text" class="kopa-ui__search" onkeyup="Kopa_UI_Icon_Picker._search( jQuery(this) );"></div><div class="kopa-ui__body"></div></div>',jQuery("body").append(a),t=Kopa_UI_Icon_Picker._getBoxObject(),o=t.find(".kopa-ui__body"),_.each(kopa_advanced_field.icon_picker.fonts,function(a){jQuery.getJSON(a.file,null,function(i,t){"success"===t&&_.each(i,function(i){var t,n;n=i.selector,t=n.split(","),_.each(t,function(i){i=_.unescape(jQuery.trim(i.replace(":before","")).substring(1)),a.prefix&&(i=a.prefix+" "+i),e&&i===e&&(i+=" kopa-ui__active"),o.append('<span><i class="'+i+'"></i></span>')})})})}),o.on("click","i",function(e){var a;e.preventDefault(),jQuery(this).hasClass("kopa-ui__active")||(a=jQuery(this).parents(".kopa-ui__body"),a.find("i").removeClass("kopa-ui__active")),jQuery(this).toggleClass("kopa-ui__active")})},_init_dialog:function(){var e;e=Kopa_UI_Icon_Picker._getBoxObject(),e.dialog({title:kopa_advanced_field.icon_picker.label.icon_picker,dialogClass:"kopa-ui-dialog kopa-ui-hide-title",closeText:'<i class="dashicons dashicons-dismiss"></i>',width:400,height:400,modal:!0,closeOnEscape:!1,resizable:!1,autoOpen:!1,buttons:[{text:kopa_advanced_field.icon_picker.label.remove,"class":"kopa-ui-button-remove button button-link button-remove",click:function(){e.dialog("close"),$kopa_icon_picker_activated.find("input").val(""),$kopa_icon_picker_activated.find("i").attr("class",""),$kopa_icon_picker_activated.find(".kopa-ui-icon-picker-add").text(kopa_advanced_field.icon_picker.label.add),Kopa_UI_Icon_Picker._clear()}},{text:kopa_advanced_field.icon_picker.label.cancel,"class":"kopa-ui-button-cancel button button-secondary",click:function(){e.dialog("close"),Kopa_UI_Icon_Picker._clear()}},{text:kopa_advanced_field.icon_picker.label.use,"class":"kopa-ui-button-use button button-primary",click:function(){var a,i;$kopa_icon_picker_activated.length&&void 0!==$kopa_icon_picker_activated&&(a=e.find(".kopa-ui__active"),i=a.length?jQuery.trim(a.attr("class").replace("kopa-ui__active","")):"",$kopa_icon_picker_activated.toggleClass("kopa-state-added"),$kopa_icon_picker_activated.find(".kopa-ui-icon-picker-add").text(kopa_advanced_field.icon_picker.label.edit),$kopa_icon_picker_activated.find("i").attr("class",i),$kopa_icon_picker_activated.find("input").val(i)),e.dialog("close"),Kopa_UI_Icon_Picker._clear()}}]})},_search:function(e){var a,i,t,o;i=Kopa_UI_Icon_Picker._getBoxObject(),t=i.find(".kopa-ui__body"),o=e.val(),o?(a=new RegExp(o,"i"),t.find("i").each(function(){jQuery(this).attr("class").search(a)<0?jQuery(this).parent().hide():jQuery(this).parent().show()})):t.find("i").parent().show()},_clear:function(){var e;$kopa_icon_picker_activated=void 0,e=Kopa_UI_Icon_Picker._getBoxObject(),e.find(".kopa-ui__search").val(""),e.find(".kopa-ui__body span").show(),e.find(".kopa-ui__body i.kopa-ui__active").removeClass("kopa-ui__active")}},Kopa_UI_Radio_Image={init:function(){var e=jQuery(".kp-ui-radio-image-container");e.length&&jQuery.each(e,function(){jQuery(this).hasClass("kopa-ui-radio-image--activated")||(jQuery(this).on("click",".kp-ui-radio-image-label",function(){jQuery(this).hasClass("kp-state-checked")||($container=jQuery(this).parents(".kp-ui-radio-image-container"),$container.find(".kp-ui-radio-image-label.kp-state-checked").removeClass("kp-state-checked"),jQuery(this).addClass("kp-state-checked"))}),jQuery(this).addClass("kopa-ui-radio-image--activated"))})}},Kopa_UI_Link={init:function(){jQuery(document).on("click",".kopa-field-link .link_button",function(e){e.preventDefault();var a,i,t,o,n,r,l,p,c;a=jQuery(this).closest(".kopa-field-link"),i=a.find("input.kopa_value"),t=a.find(".url-label"),o=a.find(".title-label"),n=i.data("json"),r=jQuery("#wp-link-submit"),l=jQuery('<input type="button" name="kopa_link-submit" id="kopa_link-submit" class="button-primary" value="Set Link">'),r.hide(),jQuery("#kopa_link-submit").remove(),l.insertBefore(r),p=jQuery('<div class="link-target kopa-link-nofollow"><label><span></span> <input type="checkbox" id="kopa-link-nofollow"> Add nofollow option to link</label></div>'),jQuery("#link-options .kopa-link-nofollow").remove(),p.insertAfter(jQuery("#link-options .link-target")),setTimeout(function(){var e=jQuery("#most-recent-results").css("top");jQuery("#most-recent-results").css("top",parseInt(e)+p.height())},200),c=window.wpLink,c.open("content"),_.isString(n.href)&&(jQuery("#wp-link-url").length?jQuery("#wp-link-url").val(n.href):jQuery("#url-field").val(n.href)),_.isString(n.title)&&(jQuery("#wp-link-text").length?jQuery("#wp-link-text").val(n.title):jQuery("#link-title-field").val(n.title)),jQuery("#wp-link-target").length?jQuery("#wp-link-target").prop("checked",!_.isEmpty(n.target)):jQuery("#link-target-checkbox").prop("checked",!_.isEmpty(n.target)),jQuery("#kopa-link-nofollow").length&&jQuery("#kopa-link-nofollow").prop("checked",!_.isEmpty(n.rel)),l.unbind("click.kopaLink").bind("click.kopaLink",function(e){e.preventDefault(),e.stopImmediatePropagation();var a,n={};n.href=jQuery("#wp-link-url").length?jQuery("#wp-link-url").val():jQuery("#url-field").val(),n.title=jQuery("#wp-link-text").length?jQuery("#wp-link-text").val():jQuery("#link-title-field").val();var p=jQuery(jQuery("#wp-link-target").length?"#wp-link-target":"#link-target-checkbox");return n.target=p[0].checked?" _blank":"",n.rel=jQuery("#kopa-link-nofollow")[0].checked?"nofollow":"",a=_.map(n,function(e,a){return _.isString(e)&&0<e.length?a+":"+encodeURIComponent(e):void 0}).join("|"),i.val(a).change(),i.data("json",n),t.html(n.href+n.target),o.html(n.title),c.close("noReset"),window.wpLink.textarea="",r.show(),l.unbind("click.kopaLink"),l.remove(),jQuery("#wp-link-cancel").unbind("click.kopaLink"),p.attr("checked",!1),jQuery("#most-recent-results").css("top",""),jQuery("#kopa-link-nofollow").attr("checked",!1),!1}),jQuery("#wp-link-cancel").unbind("click.kopaLink").bind("click.kopaLink",function(e){return e.preventDefault(),c.close("noReset"),l.unbind("click.kopaLink"),l.remove(),jQuery("#wp-link-cancel").unbind("click.kopaLink"),jQuery("#wp-link-close").unbind("click.kopaCloseLink"),window.wpLink.textarea="",!1}),jQuery("#wp-link-close").unbind("click").bind("click.kopaCloseLink",function(e){return e.preventDefault(),c.close("noReset"),l.unbind("click.kopaLink"),l.remove(),jQuery("#wp-link-cancel").unbind("click.kopaLink"),jQuery("#wp-link-close").unbind("click.kopaCloseLink"),window.wpLink.textarea="",!1})})}},Kopa_UI_Group={init:function(){jQuery(document).on("click",".kopa_group .group_nav a",function(e){var a=jQuery(this),i=a.attr("href");a.closest("ul").find(".active").removeClass("active"),a.addClass("active"),jQuery(".kopa_group .group_item.active").removeClass("active");var t=jQuery(".kopa_group "+i);t.addClass("active"),jQuery(document).trigger("kopa_group_active",[t]),e.preventDefault()})}};